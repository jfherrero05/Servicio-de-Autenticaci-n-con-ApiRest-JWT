<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Bienvenida</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-success bg-opacity-10 d-flex justify-content-center align-items-center vh-100">
    
    <div id="contenido" class="card p-5 shadow text-center d-none">
        <h2>Hola, <span id="usuarioNombre" class="text-primary"></span> ðŸ‘‹</h2>
        <p class="fs-4">Hora del servidor: <strong id="horaServidor"></strong></p>
        <p class="text-muted">Has accedido correctamente con un JWT vÃ¡lido.</p>
        
        <button onclick="cerrarSesion()" class="btn btn-danger mt-3">Cerrar SesiÃ³n</button>
    </div>

    <script>
        async function cargarBienvenida() {
            const token = localStorage.getItem('token');

            // Si no hay token, redirigir [cite: 69]
            if (!token) {
                window.location.href = 'sinpermisos.html';
                return;
            }

            // Llamada protegida a la API [cite: 64, 85]
            const response = await fetch('api/welcome.php', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            });

            // Manejo de errores 401/403 [cite: 94]
            if (response.status === 401 || response.status === 403) {
                window.location.href = 'sinpermisos.html';
            } else {
                const data = await response.json();
                document.getElementById('usuarioNombre').textContent = data.usuario;
                document.getElementById('horaServidor').textContent = data.hora;
                document.getElementById('contenido').classList.remove('d-none');
            }
        }

        // FunciÃ³n Logout [cite: 72]
        function cerrarSesion() {
            localStorage.removeItem('token');
            window.location.href = 'login.html';
        }

        // Ejecutar al inicio
        cargarBienvenida();
    </script>
</body>
</html>